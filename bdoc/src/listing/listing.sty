% == PACKAGES == %

\RequirePackage{tcolorbox}[2023/06/19]
\tcbuselibrary{minted, breakable, skins}


% == TOOLS == %

% -- LATEX EXAMPLES -- %

% :: INLINE SHORT LATEX CODE :: %

%%%
% See the \doc of the macro ``\newmintinline`` from the package ``minted``
% to have \infos about the macro ``bdocinlatex``.
%%%
\newmintinline[bdocinlatex]{latex}{}


% :: SHORTCUTS FOR TCOLORBOX LISTING FORMATING :: %

\ExplSyntaxOn

%%%
% In the following easy-to-understand macro, we use one fictive ``tcolorbox``
% style such as to indicate an unknown ``bdoc`` style to the user.
% For example, this can give one message similar to the following one.
%
% term::
%     Package pgfkeys Error: I do not know the key '/tcb/bdoclatex bad option
%     "NOT-A-STYLE"' and I am going to ignore it. Perhaps you misspelled it.
%
%     See the pgfkeys package documentation for explanation.
%%%
\NewExpandableDocumentCommand{\bdoc@latex@listing@formating}{m}{
  \str_case:nnF { #1 } {
    { sbs  } { listing ~ side ~ text }
    { code } { listing ~ only }
    { std  } { listing ~ and ~ text }
  } { bdoclatex ~ bad ~ option ~ "#1" }
}

\ExplSyntaxOff


% :: THE TCOLORBOX LISTING STYLE :: %

%%%
% note::
%     The settings used come from the following sources.
%         * https://tex.stackexchange.com/a/604821/6880
%         * https://tex.stackexchange.com/a/327983/6880
%%%
\tcbset{
  bdoclatex_tcbstyle/.style = {
    minted language = latex,
    breakable,
% Code and output
    colback = yellow!5,
% Frame
    colframe = darkgray,
    shadow   = {.75mm}{-.75mm}{0mm}{black!30},
    arc      = .75mm,
    left     = 1mm, right = 1mm,
    bottom   = 1mm, top   = 1mm,
% We can use  ``sharp corners'' to obtain an "old school" style.
%
% Separating line
    enhanced,
    segmentation style = {
      gray,
      dash pattern = {on 5pt off 2.5pt},
      line width   = 1.25pt
    },
    #1
  },
}


% :: TCOLORBOX LISTING ENVIRONMENT :: %

%%%
% prototype::
%     #1 : the style to be used (code only, code and output side by side,
%          or the standard style corresponding to the code followed by
%          its output)
%        @ #1 in [code, sbs, std]
%
% note::
%     See the \doc of the macro ``\newtcblisting`` from the package
%     ``tcolorbox`` to have \infos about the environment ``bdoclatex``.
%%%
\newtcblisting{bdoclatex}[1][std]{%
  bdoclatex_tcbstyle = \bdoc@latex@listing@formating{#1}
}


% :: TCOLORBOX IMPORTED LISTING MACRO :: %

%%%
% prototype::
%     #1 : :see: \newtcblisting{bdoclatex}.
%     #2 : the path of the file to input and format.
%
% note::
%     See the \doc of the macro ``\newtcbinputlisting`` from the package
%     ``tcolorbox`` to have more \infos about the macro ``\bdoclatexinput``.
%%%
\newtcbinputlisting{\bdoclatexinput}[2][std]{
  listing file = {#2},
  bdoclatex_tcbstyle = \bdoc@latex@listing@formating{#1}
}


% :: SHOWCASE :: %

%%%
% prototype::
%     #2 : a one-line description printed between the code and its focused
%          output
%     #3 : the text before the real output
%     #4 : the text after the real output
%     #5 : a path of a file
%
% This macro shows one \src code followed by its output, this last one beeing
% focused by the texts ``#3`` and ``#4`` decorated by one rule; the \src code
% and its ouput are se^rated by the text ``#2``.
%
% warning::
%     It is not possible to change the color of the colored stripe and/or
%     the decorated texts printed around the real output.
%%%
\NewDocumentCommand{\bdoclatexshow}{
  s
  D<>{\bdoc@trans@this@gives \bdoc@colon}
  O{\bdoc@trans@latex@show@start}
  O{\bdoc@trans@latex@show@end}
  m
}{
  \bdoclatexinput[code]{#5}

  #2

  \IfBooleanTF{#1}{
    \medskip

    \begin{bdocshowcase*}[#3][#4]
      \input{#5}
    \end{bdocshowcase*}
  }{
    \begin{bdocshowcase}[#3][#4]
      \input{#5}
    \end{bdocshowcase}
  }
}
