% == PACKAGES == %

\RequirePackage{tcolorbox}

% We use the big machinery of the package ``tcolorbox`` and its library
% ``minted`` to colorize the ¨latex codes.

\tcbuselibrary{minted, breakable, skins}


% == TOOLS == %

% -- LATEX EXAMPLES - INLINE -- %

%%%
% The macro ``bdocinlatex`` is just built via ``\newmintinline`` proposed
% by the package ``minted``.
%
% note::
%     Be careful of the ``i`` for "inline".
%%%
\newmintinline[bdocinlatex]{latex}{}


% -- LATEX EXAMPLES - MULTILINE -- %

%%%
% The following environments to display multiline code are defined easily
% with ``\newtcblisting``.
%
%     1) ``bdoclatex`` prints side by side the ¨latex code on the left and
%        its output on the right inside the same frame.
%
%     2) ``bdoclatex-flat`` prints the ¨latex code above its output inside
%        the same frame.
%
%     3) ``bdoclatex-alone`` prints only the ¨latex code inside a frame.
%
% Thanks to ``\newtcbinputlisting``, there are also the following macros
% with similar features but for imported files.
%
%     1) ``\inputbdoclatex``
%     2) ``\inputbdoclatexflat``
%     3) ``\inputbdoclatexalone``
%%%

% Sources
%    * https://tex.stackexchange.com/a/604821/6880
%    * https://tex.stackexchange.com/a/327983/6880
\tcbset{
    bdoc_tcb_style_latex_code/.style={
        minted language = latex,
        breakable,
% Code and output
        colback = yellow!5,
% Frame
        colframe = darkgray,
        shadow   = {.75mm}{-.75mm}{0mm}{black!30},
%        sharp corners, % OLD STYLE !
        arc    = .75mm,
        left   = 1mm, right = 1mm,
        bottom = 1mm, top   = 1mm,
% Separating line
        enhanced,
        segmentation style = {
            gray,
            dash pattern = {on 5pt off 2.5pt},
            line width   = 1.25pt
        },
    }
}


\newtcblisting{bdoclatex}{%
    bdoc_tcb_style_latex_code,
    listing side text,
}


\newtcbinputlisting{\inputbdoclatex}[2][]{
    listing file = {#2},
    bdoc_tcb_style_latex_code,
    listing side text,
}


\newtcblisting{bdoclatex-flat}{
    bdoc_tcb_style_latex_code,
}


\newtcbinputlisting{\inputbdoclatexflat}[2][]{
    listing file = {#2},
    bdoc_tcb_style_latex_code,
}


\newtcblisting{bdoclatex-alone}{
    bdoc_tcb_style_latex_code,
    listing only,
}


\newtcbinputlisting{\inputbdoclatexalone}[2][]{
    listing file = {#2},
    bdoc_tcb_style_latex_code,
    listing only,
}


%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro inputs directly the content a file inside an environment
% ``center`` and then displays the ¨latex source code of the file.
%
% A one-line descriptive text is put between the output and its ¨latex
% source code.
%
% note::
%     The default descriptive text between the ¨latex code and its output
%     is translated to the language chosen at the loading of the package.
%%%
\NewDocumentCommand{ \inputbdoclatexafter }{
    O{\bdoc@trans@code@after@output}
    m
}{
    \begin{center}
        \input{#2}
    \end{center}

    \vspace{-.5em}

    #1

    \inputbdoclatexalone{#2}
}


%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro is similar to ``\inputbdoclatexafter`` except that the ¨latex
% code is before the centered output.
%%%
\NewDocumentCommand{ \inputbdoclatexbefore }{
    O{\bdoc@trans@output@after@code}
    m
}{
    \inputbdoclatexalone{#2}
    \vspace{-.75em}
    \begin{center}
        \textit{\footnotesize #1}

        \medskip

        \input{#2}
    \end{center}
}


%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro is similar to ``\inputbdoclatexbefore`` except that the output
% is put inside an environment ``bdocshowcase`` instead of being centered.
%%%
\NewDocumentCommand{ \inputbdoclatexreal }{
    O{\bdoc@trans@colon{\bdoc@trans@this@gives}}
    m
}{
    \inputbdoclatexalone{#2}

    #1

    \begin{bdocshowcase}
        \input{#2}
    \end{bdocshowcase}
}
