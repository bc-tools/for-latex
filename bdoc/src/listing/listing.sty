% == PACKAGES == %

% We use the big machinery of the package ``tcolorbox`` and its library
% ``minted`` to colorize the ¨latex codes.

\RequirePackage{tcolorbox}
\tcbuselibrary{minted, breakable, skins}


% == TOOLS == %

% -- LATEX EXAMPLES - INLINE -- %

%%%
% The macro ``bdocinlatex`` is just built via ``\newmintinline`` proposed
% by the package ``minted``.
%
% note::
%     Be careful of the ``i`` for "inline".
%%%
\newmintinline[bdocinlatex]{latex}{}


% -- LATEX EXAMPLES - MULTILINE -- %

%%%
% The following environments to display multiline code are defined easily
% with ``\newtcblisting``.
%
%     1) ``bdoclatex`` prints side by side the ¨latex code on the left and
%        its output on the right inside the same frame.
%
%     2) ``bdoclatex-flat`` prints the ¨latex code above its output inside
%        the same frame.
%
%     3) ``bdoclatex-alone`` prints only the ¨latex code inside a frame.
%
% Thanks to ``\newtcbinputlisting``, there are also the following macros
% with similar features but for imported files.
%
%     1) ``\inputbdoclatex``
%     2) ``\inputbdoclatexflat``
%     3) ``\inputbdoclatexalone``
%%%

\ExplSyntaxOn

\NewDocumentCommand{\bdoc@latex@listing@formatting}{m}{
    \str_case:nnF { #1 } {
        {sbs}{listing ~ side ~ text}
        {code}{listing ~ only}
        {std}{listing ~ and ~ text } % What to add here ?
    } { }
}

\ExplSyntaxOff

% Sources
%    * https://tex.stackexchange.com/a/604821/6880
%    * https://tex.stackexchange.com/a/327983/6880
\tcbset{
    bdoc_tcb_style_latex_code/.style = {
        minted language = latex,
        breakable,
% Code and output
        colback = yellow!5,
% Frame
        colframe = darkgray,
        shadow   = {.75mm}{-.75mm}{0mm}{black!30},
%        sharp corners, % OLD STYLE !
        arc    = .75mm,
        left   = 1mm, right = 1mm,
        bottom = 1mm, top   = 1mm,
% Separating line
        enhanced,
        segmentation style = {
            gray,
            dash pattern = {on 5pt off 2.5pt},
            line width   = 1.25pt
        },
        #1
    },
}

\newtcblisting{bdoclatex}[1][std]{%
    bdoc_tcb_style_latex_code = \bdoc@latex@listing@formatting{#1}
}


\newtcbinputlisting{\bdoclatexinput}[2][std]{
    listing file = {#2},
    bdoc_tcb_style_latex_code = \bdoc@latex@listing@formatting{#1}
}



\ExplSyntaxOn

\NewDocumentCommand{\bdoclatexshow}{O{co}}{
    \str_case:nnF { #1 } {
        {co}{\bdoc@latex@show@code@text}
        {oc}{\bdoc@latex@show@text@code}
        {real}{\bdoc@latex@show@code@real}
    } { }
}

\ExplSyntaxOff

%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro inputs directly the content a file inside an environment
% ``center`` and then displays the ¨latex source code of the file.
%
% A one-line descriptive text is put between the output and its ¨latex
% source code.
%
% note::
%     The default descriptive text between the ¨latex code and its output
%     is translated to the language chosen at the loading of the package.
%%%
\NewDocumentCommand{ \bdoc@latex@show@text@code }{
    D<>{\bdoc@trans@code@after@output}
    m
}{
    \begin{center}
        \input{#2}
    \end{center}

    \vspace{-.5em}

    #1

    \bdoclatexinput[code]{#2}
}


%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro is similar to ``\inputbdoclatexafter`` except that the ¨latex
% code is before the centered output.
%%%
\NewDocumentCommand{ \bdoc@latex@show@code@text }{
    D<>{\bdoc@trans@output@after@code}
    m
}{
    \bdoclatexinput[code]{#2}
    \vspace{-.75em}
    \begin{center}
        \textit{\footnotesize #1}

        \medskip

        \input{#2}
    \end{center}
}


%%%
% prototype::
%     #1 : a one-line descriptive text
%     #2 : a path of a file
%
% This macro is similar to ``\inputbdoclatexbefore`` except that the output
% is put inside an environment ``bdocshowcase`` instead of being centered.
%%%
\NewDocumentCommand{ \bdoc@latex@show@code@real }{
    D<>{\bdoc@trans@this@gives \bdoc@colon}
    m
}{
    \bdoclatexinput[code]{#2}

    #1

    \begin{bdocshowcase}
        \input{#2}
    \end{bdocshowcase}
}
